---
import BlogPost from "@layouts/BlogPost.astro";
import { type CollectionEntry, getCollection, render } from "astro:content";

export async function getStaticPaths() {
    const posts = await getCollection("blog");
    const headings = await Promise.all(
        posts.map((post) => render(post).then((data) => data.headings)),
    );
    return posts.map((post, index) => ({
        params: { slug: post.id },
        props: { post, headings: headings[index] },
    }));
}

type Props = {
    post: CollectionEntry<"blog">;
    headings: any;
};

const { post, headings } = Astro.props as Props;
const { Content } = await render(post);
---

<BlogPost {...post.data} headings={headings}>
    <Content />
</BlogPost>
